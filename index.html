<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Fraud Analysis Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
    margin: 0;
    font-family: 'Segoe UI', sans-serif;
    background: #0f172a;
    color: white;
}

header {
    padding: 25px;
    text-align: center;
    font-size: 32px;
    font-weight: bold;
    background: linear-gradient(90deg, #0ea5e9, #6366f1);
}

.container {
    display: flex;
    min-height: 100vh;
}

.dashboard {
    flex: 3;
    padding: 30px;
}

.card {
    background: #1e293b;
    padding: 25px;
    margin-bottom: 25px;
    border-radius: 14px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.4);
    transition: 0.3s;
}

.card:hover {
    transform: translateY(-4px);
}

.card h2 {
    margin-top: 0;
    color: #38bdf8;
    font-size: 18px;
}

.placeholder {
    margin-top: 70px;
    text-align: center;
    color: #94a3b8;
    font-size: 15px;
}

.chatbot {
    flex: 1;
    background: #111827;
    padding: 25px;
    border-left: 3px solid #38bdf8;
    display: flex;
    flex-direction: column;
}

.chatbot h2 {
    margin-top: 0;
    color: #38bdf8;
}

.chat-window {
    flex: 1;
    background: #1f2937;
    border-radius: 12px;
    padding: 15px;
    margin-top: 15px;
    overflow-y: auto;
}

.chat-input {
    margin-top: 15px;
    display: flex;
}

.chat-input input {
    flex: 1;
    padding: 10px;
    border-radius: 8px;
    border: none;
    outline: none;
}

.chat-input button {
    margin-left: 10px;
    padding: 10px 15px;
    border-radius: 8px;
    border: none;
    background: #38bdf8;
    color: black;
    font-weight: bold;
    cursor: pointer;
}

@media (max-width: 900px) {
    .container {
        flex-direction: column;
    }
    .chatbot {
        height: 400px;
    }
}
</style>
</head>

<body>

<header>
Fraud Analysis Dashboard
</header>

<div class="container">

<div class="dashboard">

<div class="card">
<h2>Fraud Overview Metrics</h2>
<div class="placeholder">[ KPI Metrics Placeholder ]</div>
</div>

<div class="card">
<h2>Geographic Fraud Distribution</h2>
<div class="placeholder">[ Map Visualization Placeholder ]</div>
</div>

<div class="card">
<h2>Provider Risk Score Analysis</h2>
<div class="placeholder">[ Risk Score Chart Placeholder ]</div>
</div>

<div class="card">
<h2>Claim Pattern Trends</h2>
<div class="placeholder">[ Time Series Visualization Placeholder ]</div>
</div>

</div>

<div class="chatbot">
<h2>AI Fraud Assistant</h2>

<div class="chat-window">
[ AI Chatbot Conversation Area ]
</div>

<div class="chat-input">
<input type="text" placeholder="Ask about fraud risk patterns...">
<button>Send</button>
</div>

</div>

</div>

<script>
const chatInput = document.querySelector('.chat-input input');
const chatButton = document.querySelector('.chat-input button');
const chatWindow = document.querySelector('.chat-window');

async function sendMessage() {
    const userMessage = chatInput.value;
    if (!userMessage) return;

    // Display user message
    chatWindow.innerHTML += `<div><b>You:</b> ${userMessage}</div>`;
    chatInput.value = '';
    chatWindow.scrollTop = chatWindow.scrollHeight;

    // Show loading indicator
    const loadingId = 'loading-message';
    chatWindow.innerHTML += `<div id="${loadingId}" style="color:#94a3b8;"><b>MCP:</b> typing...</div>`;
    chatWindow.scrollTop = chatWindow.scrollHeight;

    try {
        // Use URL-encoded form to avoid preflight OPTIONS
        const formData = new URLSearchParams();
        formData.append("term", userMessage);

        const response = await fetch('https://dian-intercommissural-superlatively.ngrok-free.dev/api/search', {
            method: 'POST',
            headers: {'Content-Type': 'application/x-www-form-urlencoded'},
            body: formData
        });

        const data = await response.json();

        // Remove loading indicator
        const loadingElem = document.getElementById(loadingId);
        if (loadingElem) loadingElem.remove();

        // Display MCP results (top 5)
        if (data.results && data.results.length > 0) {
            data.results.slice(0,5).forEach(r => {
                chatWindow.innerHTML += `
                    <div style="margin-bottom:10px;">
                        <b>${r.Title}</b><br>
                        ${r.WebPage.Content || ''}<br>
                        <a href="${r.WebPage['Link to Full Report']}" target="_blank" style="color:#38bdf8;">View Full Report</a>
                    </div>`;
            });
        } else {
            chatWindow.innerHTML += `<div><b>MCP:</b> No results found</div>`;
        }

    } catch (err) {
        console.error(err);
        const loadingElem = document.getElementById(loadingId);
        if (loadingElem) loadingElem.remove();
        chatWindow.innerHTML += `<div><b>MCP:</b> Error fetching results</div>`;
    }

    chatWindow.scrollTop = chatWindow.scrollHeight;
}

chatButton.addEventListener('click', sendMessage);
chatInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') sendMessage();
});
</script>

</body>
</html>
